[{"version":"45","lock":false,"zoom":0.4858483076095581,"panx":826.4927978515625,"pany":-296.0645446777344,"font_size":14,"snap_grid":true,"standard_size":true,"type":"diagram","theme":"Plain_Theme"},{"id":"235334499","label":".h. Интерфейс связи с десктопом\n............................................................\n1. Используем wifi (ethernet) udp\n2. функции:\n. а) передача данных от контроллеров (через распи) на pc\n.. i) распи принимает данные от контроллеров в реальном времени\n.. ii) распи ретранслирует данные на pc в реальном времени\n.. iii) распи формирет пакеты (фреймы) из данных от контроллеров\n.. iiii) внутри одного пакета все данные синхронизированы\n.. iiiii) длина одного пакета: 8*20*4 = 640 байт (т.е. по 20 синхронизированных значений с каждого датика)","fill":"FILL","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":770,"center.y":-340,"points":[480.0000305175781,-500,1060,-500,1059.999755859375,-180,480.0000305175781,-180.00064086914063],"lineType":"SOLID"},{"id":"104633184","label":".h. sensors_board_spi_channel_obj\n...........................................................","fill":"FILL","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":470,"center.y":700,"points":[300,640,640,640,639.9998779296875,759.999755859375,300,760],"lineType":"SOLID"},{"id":"150089753","label":".h. spi_interface_obj\n.....................................\n","fill":"FILL","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":480.00018310546875,"center.y":1079.999755859375,"points":[380,1039.999755859375,580.0003662109375,1039.999755859375,580.0003662109375,1119.999755859375,380,1119.999755859375],"lineType":"SOLID"},{"id":"102516958","label":"address","fill":"FILL","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTROUND","center.x":260,"center.y":1090,"width":80,"height":60,"lineType":"SOLID"},{"id":"32692927","label":"data","fill":"CLEAR","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTROUND","center.x":700.0001220703125,"center.y":1090,"width":80,"height":60,"lineType":"SOLID"},{"id":"29853068","label":".h. data_frame_obj\n...................................","fill":"FILL","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTROUND","center.x":890,"center.y":670,"width":140,"height":100,"lineType":"SOLID"},{"id":"49067221","label":"","fill":"FILL","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTROUND","center.x":480,"center.y":1100,"width":600,"height":280,"lineType":"SOLID"},{"id":"262149354","label":".h. data_out_channel_obj\n............................................","fill":"FILL","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":1350,"center.y":710,"points":[1220,660,1479.998779296875,660,1480,759.9994506835938,1220,760],"lineType":"SOLID"},{"id":"75785179","label":".h. udp_socket_obj\n..................................","fill":"FILL","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":1470,"center.y":950,"points":[1400,900,1540,900,1540,1000,1400,1000],"lineType":"SOLID"},{"id":"153972344","label":"wi-fi ip 21112 port","fill":"FILL","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTROUND","center.x":1790,"center.y":950,"width":140,"height":60,"lineType":"SOLID"},{"id":"147900753","label":"udp packet","fill":"FILL","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTROUND","center.x":1270,"center.y":950,"width":100,"height":59.999996185302734,"lineType":"SOLID"},{"id":"65181110","label":".h. настройки\n...........................\n1. генерируемый поток данных\n. контроллеров 8 штук\n. контроллеры опрашивают сенсоры с частотой 20 КГц\n. порождается 8*20000*4 = 640 КБ в секунду (или 5 мегабит в секунду).\n2. частота опроса контроллеров.\n. один udp пакет = 640 байт (20*4*8), по 20 значений с каждого датчика\n. логично за один запрос получать именно 20 значений\n. получается, период опроса = 1 милисекунде\n3. контроллеры опрашиваются последовательно\n. период опроса задается таймером\n. (вариант) момент начала опроса задается синхроимпульсом мастер-контроллера","fill":"FILL","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":-380,"center.y":670,"points":[-599.9993286132813,480,-160.002197265625,480,-159.99996948242188,860,-600,860],"lineType":"SOLID"},{"id":"31154871","label":".h. настройки spi\n.................................\n1. частота клока: не меньше 10 МГц (лучше 15)\n2. длина посылки: 2 байта (лучше 4, если прокатит)\n","fill":"FILL","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":200,"center.y":840,"points":[100,780,300,780,299.9998474121094,900,99.99999237060547,899.9999389648438],"lineType":"SOLID"},{"id":"50788900","label":"длина пакета: 20*4*8 = 640","fill":"FILL","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":1150,"center.y":1070,"points":[1100,1040,1200,1040,1200,1099.999755859375,1100,1100],"lineType":"SOLID"},{"id":"101165453","label":".h. Тестирование интерфейса spi\n...........................................................\n1. Задача: убдиться, что spi raspi успевает скачивать данные с контроллеров он-лайн\n2. Выбрать тактовую частоту spi\n3. Выбрать длину массива, который передается в одном сеансе связи\n4. Убедиться, что за время накопления массива, raspi успевает опросить все контроллеры (с запасом).\n..................................................................\nв одном цикле опроса:\n. переключить отладочный пин\n. N раз прочитать данные (4 байта)\n..","fill":"FILL","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":-180,"center.y":1490,"points":[-460,1320,99.99999237060547,1320,99.99987030029297,1659.99951171875,-460,1660],"lineType":"SOLID"},{"id":"117069634","label":"debug","fill":"FILL","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTROUND","center.x":430,"center.y":1180,"width":60,"height":40,"lineType":"SOLID"},{"id":"238646099","label":".h. gpio_obj\n.....................\n","fill":"FILL","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":390,"center.y":1450,"points":[320,1400,460,1400,460,1500,320,1500],"lineType":"SOLID"},{"id":"80450704","label":"","fill":"CONNECTOR","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"0","connect.a":"102516958","connect.b":"150089753","points":[300,1090,380,1079.999755859375],"arrow.b":"true","arrow.b.type":"LINE","lineType":"SOLID","connectorType":1},{"id":"156389769","label":"","fill":"CONNECTOR","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"0","connect.a":"150089753","connect.b":"32692927","points":[580.0003662109375,1079.999755859375,660.0001220703125,1090],"arrow.b":"true","arrow.b.type":"LINE","lineType":"SOLID","connectorType":1},{"id":"98215310","label":"data","fill":"CONNECTOR","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"0","connect.a":"104633184","connect.b":"29853068","points":[639.9999389648438,719.9998779296875,825.3284301757813,689.1341552734375],"arrow.b":"true","arrow.b.type":"LINE","lineType":"SOLID","connectorType":1},{"id":"106820015","label":"commands\ndata","fill":"CONNECTOR","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"0","connect.a":"104633184","connect.b":"49067221","points":[489.99993896484375,759.9998779296875,480,960],"arrow.a":"true","arrow.a.type":"LINE","arrow.b":"true","arrow.b.type":"LINE","lineType":"SOLID","connectorType":1},{"id":"33384892","label":"udp datagram","fill":"CONNECTOR","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"0","connect.a":"75785179","connect.b":"153972344","points":[1540,950,1720,950],"arrow.b":"true","arrow.b.type":"LINE","lineType":"SOLID","connectorType":1},{"id":"42302789","label":"","fill":"CONNECTOR","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"0","connect.a":"29853068","connect.b":"262149354","points":[960,670,1220,710],"arrow.b":"true","arrow.b.type":"LINE","lineType":"SOLID","connectorType":1},{"id":"123702426","label":"","fill":"CONNECTOR","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"0","connect.a":"262149354","connect.b":"147900753","points":[1310,759.9998168945313,1270,920],"arrow.b":"true","arrow.b.type":"LINE","lineType":"SOLID","connectorType":1},{"id":"161610187","label":"","fill":"CONNECTOR","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"0","connect.a":"147900753","connect.b":"75785179","points":[1320,950,1400,950],"arrow.b":"true","arrow.b.type":"LINE","lineType":"SOLID","connectorType":1},{"id":"34956712","label":"","fill":"CONNECTOR","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"1","connect.a":"65181110","connect.b":"104633184","points":[-160.00155639648438,590,-73.25439453125,582.1510620117188,-173.5526123046875,662.7556762695313,300,680],"arrow.b":"true","arrow.b.type":"LINE","lineType":"SOLID","connectorType":1},{"id":"370881","label":"","fill":"CONNECTOR","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"1","connect.a":"65181110","connect.b":"31154871","points":[-160.00155639648438,590,-153.0936737060547,585.181396484375,-154.78829956054688,640.946533203125,180,780],"arrow.b":"true","arrow.b.type":"LINE","lineType":"SOLID","connectorType":1},{"id":"35248230","label":"","fill":"CONNECTOR","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"1","connect.a":"31154871","connect.b":"49067221","points":[199.9999237060547,900,162.54071044921875,954.838134765625,260.53314208984375,864.7351684570313,267.867919921875,1001.0050659179688],"arrow.b":"true","arrow.b.type":"LINE","lineType":"SOLID","connectorType":1},{"id":"164915111","label":"","fill":"CONNECTOR","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"1","connect.a":"50788900","connect.b":"147900753","points":[1150,1040,1127.185791015625,978.1552734375,1197.0198974609375,915.7660522460938,1234.6446533203125,928.7868041992188],"arrow.b":"true","arrow.b.type":"LINE","lineType":"SOLID","connectorType":1},{"id":"154088532","label":"","fill":"CONNECTOR","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"1","connect.a":"101165453","connect.b":"49067221","points":[-86.66668701171875,1320,-199.2705841064453,1148.5745849609375,60.287841796875,1052.0072021484375,180,1100],"arrow.b":"true","arrow.b.type":"LINE","lineType":"SOLID","connectorType":1},{"id":"134418429","label":"","fill":"CONNECTOR","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"0","connect.a":"117069634","connect.b":"150089753","points":[441.4804992675781,1161.5224609375,460.00018310546875,1119.999755859375],"arrow.b":"true","arrow.b.type":"LINE","lineType":"SOLID","connectorType":1},{"id":"47912178","label":"","fill":"CONNECTOR","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"1","connect.a":"238646099","connect.b":"49067221","points":[410,1400,471.2129821777344,1254.7471923828125,-22.011445999145508,1256.689697265625,202.83615112304688,1153.57568359375],"arrow.b":"true","arrow.b.type":"LINE","lineType":"SOLID","connectorType":1},{"id":"215340867","label":"","fill":"CONNECTOR","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"1","connect.a":"238646099","connect.b":"49067221","points":[410,1400,485.20831298828125,1295.5303955078125,330.1458740234375,1331.7880859375,365.1949462890625,1229.3431396484375],"arrow.b":"true","arrow.b.type":"LINE","lineType":"SOLID","connectorType":1}]