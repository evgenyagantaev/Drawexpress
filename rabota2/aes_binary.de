[{"version":"45","lock":false,"zoom":1.177890658378601,"panx":-2845.568603515625,"pany":-2227.995849609375,"font_size":14,"snap_grid":true,"standard_size":true,"type":"diagram","theme":"Plain_Theme"},{"id":"184883100","label":".h.binary_parser_obj\n....................................\nconst uint8_t *UCAST_PREFIX = \"\\r\\nUCAST:\"\nconst uint8_t *CARRET_RETURN = \"\\r\\n\";\n-------------------------------------------------------------------------\n","fill":"#ffeb3b","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":6.103515625E-5,"center.y":690,"points":[-160,580,160.0001220703125,580,160,800,-160,799.9998779296875],"lineType":"SOLID"},{"id":"218416549","label":".h.UARTclass\n............................\n------------------------------------------------\nvoid USART1_IRQHandler();\n------------------------------------------------\n","fill":"#ffeb3b","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":890,"center.y":740,"points":[719.9999389648438,580,1059.998779296875,580,1060,900,719.9999389648438,899.9989624023438],"lineType":"SOLID"},{"id":"31366522","label":".h.Main thread","fill":"#ce93d8","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTGROUP","connector":0,"group":[{"thickness":2,"shape":"polygon","fill":"#ce93d8","lineType":"SOLID","points":[-660,249.99996948242188,-716.0003662109375,280,-940,279.999755859375,-884.0001220703125,249.99990844726563,-940,220,-716.0003662109375,220]}],"icons":[],"textbox":[-884.0001220703125,220,-716.0003662109375,220,-716.0003662109375,280,-884.0001220703125,280],"textalign":"CENTER","lineType":"SOLID"},{"id":"102787371","label":".h.usart reading thread\n(asinchronous)","fill":"#ce93d8","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTGROUP","connector":0,"group":[{"thickness":2,"shape":"polygon","fill":"#ce93d8","lineType":"SOLID","points":[-220.00006103515625,249.99996948242188,-276.0003662109375,280,-500,279.999755859375,-444.00006103515625,249.99990844726563,-500,220,-276.0003662109375,220]}],"icons":[],"textbox":[-444.0001220703125,220,-276.0003662109375,220,-276.0003662109375,280,-444.0001220703125,280],"textalign":"CENTER","lineType":"SOLID"},{"id":"236589448","label":".h.usart rxne irq","fill":"FILL","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTGROUP","connector":0,"group":[{"shape":"ellipse","fill":"FILL","thickness":2,"cx":"-3.6621094E-4","cy":"57.999992","w":"39.99971","h":"35.99997","lineType":"SOLID"},{"shape":"line","curve":"0","points":[-3.0517578125E-4,76.00000762939453,-4.2724609375E-4,117.99995422363281],"lineType":"SOLID"},{"shape":"line","curve":"0","points":[-40.0003662109375,87.99998474121094,39.999267578125,88.00001525878906],"lineType":"SOLID"},{"shape":"line","curve":"0","points":[-4.2724609375E-4,117.99995422363281,-40.00067138671875,159.99993896484375],"lineType":"SOLID"},{"shape":"line","curve":"0","points":[-4.2724609375E-4,117.99995422363281,39.99932861328125,160],"lineType":"SOLID"}],"icons":[],"textbox":[-40.00006103515625,40,39.999267578125,40,39.99932861328125,160,-40.00067138671875,159.99993896484375],"textalign":"OUTER_BOTTOM","lineType":"SOLID"},{"id":"161552161","label":".h.usart parsing thread\n(asinchronous)","fill":"#ce93d8","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTGROUP","connector":0,"group":[{"thickness":2,"shape":"polygon","fill":"#ce93d8","lineType":"SOLID","points":[-220.00006103515625,430,-276.0003662109375,460,-500,459.999755859375,-444.00006103515625,429.99993896484375,-500,400,-276.0003662109375,400]}],"icons":[],"textbox":[-444.0001220703125,400,-276.0003662109375,400,-276.0003662109375,460,-444.0001220703125,460],"textalign":"CENTER","lineType":"SOLID"},{"id":"53024582","label":".h.komanda\n.............................\n1. Komanda imeet strukturu:\n\"\\r\\nUCAST:XXXXXXXXXXXXXXXX,YYYY\\r\\n\"\nGde X...X - 16-bitnyi adres, a Y...Y - binarnyi paket\n2. Struktura paketa:\nABCE....ERR\nA - kolichestvo paketov v peredache\nB - nomer paketa v peredache\nC - dlina paketa (vklyuchaya CRC)\nE...E - binarnye dannye\nRR - CRC (po vsemu paketu, vklyuchaya pervye tri baita)\n3. Zadacha parsera:\na) naiti podstroku \"\\r\\nUCAST:\"\nb) schitat' i zapomnit'' 16-baitnyi adres otpravitelya\nc) prochitat' dlinu paketa\nd) schitat' i zapomnit' ves' paket\ne) peredat' paru adres-paket interpretatoru komand\nf) udalit' paket iz bufera\n","fill":"#dcedc8","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":1020,"center.y":-460,"points":[760,-680,1280,-680,1280,-240.0001220703125,760,-240],"lineType":"SOLID"},{"id":"62549255","label":".h.long_buffer_obj\n....................................\n#define LONG_BUFFER_LENGTH 1024\n-------------------------------------------------------------\nuint8_t long buffer[LONG_BUFFER_LENGTH];\nint long_buffer_in_index = 0;\nint long_buffer_off_index = 0;\nint long_buffer_overflow_flag = 0;\n.\n---------------------------------------------------------------\nvoid add_new_charachter_to_long_buffer();\n// returns number of cut bytes, -1 if something wrong\nint cut_subarray(int low_index, int high index, uin8_t *buffer_to_cut_in);\n","fill":"#ffeb3b","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":2760,"center.y":440.0000305175781,"points":[2479.999755859375,259.99993896484375,3040.000244140625,259.99993896484375,3039.999267578125,620.0001220703125,2479.999755859375,619.998779296875],"lineType":"SOLID"},{"id":"235060788","label":".h.usart rxne irq\n.................................\n1. proverit' flag rxne (sbrosit')\n2. prochitat' registr dannyh usart\n3. zapisat' bait v korotkiy bufer\n4. ustanovit' flag prochteniya novogo baita\n","fill":"#ce93d8","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":1230,"center.y":670,"points":[1080,580,1379.99951171875,580,1380,760,1080,760],"lineType":"SOLID"},{"id":"223806557","label":".h.long_buffer_task\n......................................\n1. proverit' flag prochteniya novogo simvola\n2. prochitat' simvol iz korotkogo bufera\n3. sbrosit' flag\n4. zapisat' simvol v dlinnyi bufer","fill":"#ce93d8","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":3220.00048828125,"center.y":370,"points":[3060.000244140625,259.99993896484375,3380.000732421875,259.99993896484375,3380.000732421875,480.0000915527344,3060.000244140625,480.0000915527344],"lineType":"SOLID"},{"id":"240083410","label":".h.binary_parser_task\n......................................\n1. naiti podstroku \"\\r\\nUCAST:\"\n2. schitat' i zapomnit'' 16-baitnyi adres otpravitelya\n3. prochitat' dlinu paketa\n4. schitat' i zapomnit' ves' paket\n5. peredat' paru adres-paket interpretatoru komand\n6. udalit' paket iz bufera\n","fill":"#ce93d8","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":350,"center.y":700,"points":[180,580,519.9999389648438,580,520,819.9996337890625,179.99998474121094,820],"lineType":"SOLID"},{"id":"34001571","label":".h.short_buffer_obj\n....................................\n#define SHORT_BUFFER_LENGTH 7\n-------------------------------------------------------------\nstatic uint8_t long buffer[SHORT_BUFFER_LENGTH];\nstatic int short_buffer_in_index = 0;\nstatic int short_buffer_off_index = 0;\nstatic   int short_buffer_overflow_flag = 0;\n.\nstatic int new_charachter_received_flag = 0;\nint get_new_charachter_received_flag();\nvoid set_new_charachter_received_flag();\nvoid reset_new_charachter_received_flag\n.\nstatic uint8_t new_charachter;\n.\n---------------------------------------------------------------\nvoid add_new_charachter_to_short_buffer();","fill":"#ffeb3b","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":3329.99951171875,"center.y":2640.00048828125,"points":[3159.99951171875,2400,3499.99951171875,2400,3499.99951171875,2880.0009765625,3159.99951171875,2880.0009765625],"lineType":"SOLID"},{"id":"237472160","label":".h.command_interpreter_obj\n................................................\n","fill":"#ffeb3b","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":0,"center.y":1000,"points":[-159.99929809570313,940,159.9998321533203,940,159.99998474121094,1059.99951171875,-160,1060],"lineType":"SOLID"},{"id":"75794777","label":".h.command_interpreter_task\n....................................................\n","fill":"#ce93d8","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":349.9998779296875,"center.y":1010,"points":[180,940,519.9996948242188,940,519.9998779296875,1080,179.99984741210938,1080],"lineType":"SOLID"},{"id":"35506462","label":".h.short_buffer_task\n...................................\n1. proverit' flag prochteniya novogo simvola\n2. zapisat' simvol v korotkii bufer\n3. sbrosit' flag\n4. vystavit' flag","fill":"#ce93d8","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":3660.000244140625,"center.y":2490.000244140625,"points":[3540,2400,3780.00048828125,2400,3780,2580.00048828125,3540,2580.00048828125],"lineType":"SOLID"},{"id":"86636031","label":".h. long buffer\n.................................\nV dlinnom bufere hranyatsya vhodnye baity. Dlinnyi bufer - vhod parsera i interpretatora komand. Parser vydelyaet smyslovye bloki, vyrezaet ih iz bufera (udalyaet) i podaet na obrabotku interpretatoru komand.","fill":"#3bc34a","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":2810,"center.y":150,"points":[2479.999755859375,100,3140.000244140625,100,3139.999755859375,200,2479.999755859375,199.99993896484375],"lineType":"SOLID"},{"id":"235642828","label":".h. длинный буфер\n...................................\nперенос байтов из короткого буфера (дозапись в конец)\nвырезание (удаление) смысловых блоков в начале буфера (делает парсер)\n. парсер вызывает вырезатель, передает ему индексы начала и конца блока, ссылку на массив, в который будет записан результат, (максимальная длина результата?)\n.. если индекс начала блока не равен 0, всё, что предшествует началу блока, отбрасывается\nсдвиг буфера после вырезания блока","fill":"#e1f5fe","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":3960.00048828125,"center.y":300.0000305175781,"points":[3480.000244140625,140,4440.00048828125,140,4439.99755859375,460.00006103515625,3480.000244140625,460.00006103515625],"lineType":"SOLID"},{"id":"158032405","label":".h. парсер\n.......................\nсканирует длинный буфер, ищет смысловые блоки","fill":"#e1f5fe","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":3660.00048828125,"center.y":720.0001220703125,"points":[3180.000244140625,560.0001220703125,4139.99951171875,560.0001220703125,4140.00048828125,880.0001220703125,3180.000244140625,880.0001220703125],"lineType":"SOLID"},{"id":"198793514","label":" .h. интерпретатор команд\n...............................................\n","fill":"#e1f5fe","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":3660.00048828125,"center.y":1149.999755859375,"points":[3180.000244140625,960,4140.00048828125,960,4140.00048828125,1339.9991455078125,3180.000244140625,1339.9996337890625],"lineType":"SOLID"},{"id":"87159579","label":".h. смысловые блоки\n...........................................\n1. бинарные пакеты\n. признак начала бинарного пакета\n. признак конца бинарного пакета\n.. (смотреть в документации)\n.\n2. стейтменты zigbee\n. признак начала стейтмента\n. признак конца стейтмента\n.. (смотреть  мануал на zigbee)\n","fill":"#e1f5fe","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":4360.0009765625,"center.y":710.0001831054688,"points":[4160.00146484375,580.0001220703125,4560.00048828125,580.0001220703125,4559.99853515625,840.000244140625,4160.00146484375,840.000244140625],"lineType":"SOLID"},{"id":"3730616","label":".h. Короткий буфер\n.......................................\nПромежуточный буфер между регистром usart и длинным буфером. Защита от переполнения.","fill":"#4caf50","fontSize":14,"textColor":"TEXT_DEFAULT","strokeColor":"DEFAULT","stroke":2,"ss.hideChildren":false,"ss.urlType":2,"type":"SMARTBOX","border":true,"center.x":3400,"center.y":2310,"points":[3160,2260,3640,2260,3639.999755859375,2360,3160,2359.998779296875],"lineType":"SOLID"},{"id":"246221457","label":"","fill":"#ff0000","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"0","connect.a":"236589448","connect.b":"102787371","points":[-40.00067138671875,80,-240.00003051757813,220],"arrow.b":"true","arrow.b.type":"STRIANGLE","lineType":"SOLID","connectorType":1},{"id":"101441014","label":".h. new_byte_received_flag","fill":"#ff0000","fontSize":14,"textColor":"TEXT_DEFAULT","stroke":2,"type":"CONNECTOR","curve":"0","connect.a":"102787371","connect.b":"161552161","points":[-360.0000305175781,280,-360.0000305175781,400],"arrow.b":"true","arrow.b.type":"STRIANGLE","lineType":"SOLID","connectorType":1}]